# count-rectanges-numpy
A basic neural network implemented using numpy to predict the number of rectangles in an image. 

</a>
<p align="center">
    <img src="https://github.com/annabond1001/count-rects-np/blob/master/demo/figure_1.png?raw=true", width="500">
</p>

A neural network with 3 fully-connected hidden layers is trained to predict the number of overlapping rectangles in a single channel image with just filled-rectangles in them.

## Forward-Pass
<a href="https://www.codecogs.com/eqnedit.php?latex=\large&space;\\&space;x&space;\in&space;R^{30\times30}&space;\rightarrow&space;input\\&space;y&space;\in&space;R&space;\rightarrow&space;ground~truth\\&space;\\&space;\hat&space;y&space;~=&space;Net(x)\\&space;\\&space;l1&space;=&space;\sigma&space;(x&space;\times&space;w1)&space;&plus;&space;b1\\&space;l2&space;=&space;\sigma&space;(l1&space;\times&space;w2)&space;&plus;&space;b2\\&space;l3&space;=&space;\sigma&space;(l2&space;\times&space;w3)&space;&plus;&space;b3\\&space;\hat&space;y&space;~=&space;(l3&space;\times&space;w4)&space;&plus;&space;b4\\&space;where,\\&space;w1,&space;w2&space;,w3,&space;w4&space;\rightarrow&space;Weight~Matrices\\&space;b1,&space;b2&space;,b3,&space;b4&space;\rightarrow&space;Bias-Vectors\\" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\large&space;\\&space;x&space;\in&space;R^{30\times30}&space;\rightarrow&space;input\\&space;y&space;\in&space;R&space;\rightarrow&space;ground~truth\\&space;\\&space;\hat&space;y&space;~=&space;Net(x)\\&space;\\&space;l1&space;=&space;\sigma&space;(x&space;\times&space;w1)&space;&plus;&space;b1\\&space;l2&space;=&space;\sigma&space;(l1&space;\times&space;w2)&space;&plus;&space;b2\\&space;l3&space;=&space;\sigma&space;(l2&space;\times&space;w3)&space;&plus;&space;b3\\&space;\hat&space;y&space;~=&space;(l3&space;\times&space;w4)&space;&plus;&space;b4\\&space;where,\\&space;w1,&space;w2&space;,w3,&space;w4&space;\rightarrow&space;Weight~Matrices\\&space;b1,&space;b2&space;,b3,&space;b4&space;\rightarrow&space;Bias-Vectors\\" title="\large \\ x \in R^{30\times30} \rightarrow input\\ y \in R \rightarrow ground~truth\\ \\ \hat y ~= Net(x)\\ \\ l1 = \sigma (x \times w1) + b1\\ l2 = \sigma (l1 \times w2) + b2\\ l3 = \sigma (l2 \times w3) + b3\\ \hat y ~= (l3 \times w4) + b4\\ where,\\ w1, w2 ,w3, w4 \rightarrow Weight~Matrices\\ b1, b2 ,b3, b4 \rightarrow Bias-Vectors\\" /></a>

## Back-Propagation
### Gradient Computation
<a href="https://www.codecogs.com/eqnedit.php?latex=\large&space;\\&space;loss&space;=&space;(y-\hat&space;y)^2&space;\\&space;\\&space;\partial&space;loss/\partial&space;\hat&space;y&space;=&space;2\times(y-\hat&space;y)&space;\\&space;\\&space;\partial&space;loss/\partial&space;w4&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;w4)&space;\\&space;~\hspace{66}&space;=&space;l3^T&space;\times&space;(\partial&space;loss/\partial&space;\hat&space;y)\\&space;\partial&space;loss/\partial&space;b4&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;b4)&space;\\&space;~\hspace{66}&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\\&space;\\" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\large&space;\\&space;loss&space;=&space;(y-\hat&space;y)^2&space;\\&space;\\&space;\partial&space;loss/\partial&space;\hat&space;y&space;=&space;2\times(y-\hat&space;y)&space;\\&space;\\&space;\partial&space;loss/\partial&space;w4&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;w4)&space;\\&space;~\hspace{66}&space;=&space;l3^T&space;\times&space;(\partial&space;loss/\partial&space;\hat&space;y)\\&space;\partial&space;loss/\partial&space;b4&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;b4)&space;\\&space;~\hspace{66}&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\\&space;\\" title="\large \\ loss = (y-\hat y)^2 \\ \\ \partial loss/\partial \hat y = 2\times(y-\hat y) \\ \\ \partial loss/\partial w4 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial w4) \\ ~\hspace{66} = l3^T \times (\partial loss/\partial \hat y)\\ \partial loss/\partial b4 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial b4) \\ ~\hspace{66} = (\partial loss/\partial \hat y)\\ \\" /></a>

<a href="https://www.codecogs.com/eqnedit.php?latex=\large&space;\\&space;\partial&space;loss/\partial&space;w3&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times&space;(\partial&space;l3/\partial&space;w3)\\&space;~\hspace{66}&space;=&space;l2^T&space;\times&space;(\partial&space;loss/\partial&space;\hat&space;y)&space;\times&space;w4^T&space;\times&space;\sigma'&space;(l3)&space;\\&space;\partial&space;loss/\partial&space;b3&space;~=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times&space;(\partial&space;l3/\partial&space;b3)\\&space;~\hspace{66}&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)&space;\times&space;(\partial&space;\hat&space;y&space;/&space;\partial&space;l3)&space;\times&space;\sigma'&space;(l3)&space;\\&space;\\" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\large&space;\\&space;\partial&space;loss/\partial&space;w3&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times&space;(\partial&space;l3/\partial&space;w3)\\&space;~\hspace{66}&space;=&space;l2^T&space;\times&space;(\partial&space;loss/\partial&space;\hat&space;y)&space;\times&space;w4^T&space;\times&space;\sigma'&space;(l3)&space;\\&space;\partial&space;loss/\partial&space;b3&space;~=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times&space;(\partial&space;l3/\partial&space;b3)\\&space;~\hspace{66}&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)&space;\times&space;(\partial&space;\hat&space;y&space;/&space;\partial&space;l3)&space;\times&space;\sigma'&space;(l3)&space;\\&space;\\" title="\large \\ \partial loss/\partial w3 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times (\partial l3/\partial w3)\\ ~\hspace{66} = l2^T \times (\partial loss/\partial \hat y) \times w4^T \times \sigma' (l3) \\ \partial loss/\partial b3 ~= (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times (\partial l3/\partial b3)\\ ~\hspace{66} = (\partial loss/\partial \hat y) \times (\partial \hat y / \partial l3) \times \sigma' (l3) \\ \\" /></a>

<a href="https://www.codecogs.com/eqnedit.php?latex=\large&space;\\&space;\partial&space;loss/\partial&space;w2&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times&space;(\partial&space;l2/\partial&space;w2)\\&space;\partial&space;loss/\partial&space;b2&space;~=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times&space;(\partial&space;l2/\partial&space;b2)\\&space;\\&space;\partial&space;loss/\partial&space;w1&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times(\partial&space;l2/\partial&space;l1)&space;\times&space;(\partial&space;l1/\partial&space;w1)\\&space;\partial&space;loss/\partial&space;b1&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times(\partial&space;l2/\partial&space;l1)&space;\times&space;(\partial&space;l1/\partial&space;b1)\\" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\large&space;\\&space;\partial&space;loss/\partial&space;w2&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times&space;(\partial&space;l2/\partial&space;w2)\\&space;\partial&space;loss/\partial&space;b2&space;~=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times&space;(\partial&space;l2/\partial&space;b2)\\&space;\\&space;\partial&space;loss/\partial&space;w1&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times(\partial&space;l2/\partial&space;l1)&space;\times&space;(\partial&space;l1/\partial&space;w1)\\&space;\partial&space;loss/\partial&space;b1&space;=&space;(\partial&space;loss/\partial&space;\hat&space;y)\times(\partial&space;\hat&space;y/\partial&space;l3)&space;\times(\partial&space;l3/\partial&space;l2)&space;\times(\partial&space;l2/\partial&space;l1)&space;\times&space;(\partial&space;l1/\partial&space;b1)\\" title="\large \\ \partial loss/\partial w2 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times(\partial l3/\partial l2) \times (\partial l2/\partial w2)\\ \partial loss/\partial b2 ~= (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times(\partial l3/\partial l2) \times (\partial l2/\partial b2)\\ \\ \partial loss/\partial w1 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times(\partial l3/\partial l2) \times(\partial l2/\partial l1) \times (\partial l1/\partial w1)\\ \partial loss/\partial b1 = (\partial loss/\partial \hat y)\times(\partial \hat y/\partial l3) \times(\partial l3/\partial l2) \times(\partial l2/\partial l1) \times (\partial l1/\partial b1)\\" /></a>

### Parameter Updation
<a href="https://www.codecogs.com/eqnedit.php?latex=\large&space;\\&space;w4&space;=&space;w4&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w4)&space;\\&space;w3&space;=&space;w3&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w3)&space;\\&space;w2&space;=&space;w2&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w2&space;\\&space;w1&space;=&space;w1&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w1)&space;\\&space;\\&space;b4&space;=&space;b4&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b4)&space;\\&space;b3&space;=&space;b3&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b3)&space;\\&space;b2&space;=&space;b2&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b2&space;\\&space;b1&space;=&space;b1&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b1)&space;\\" target="_blank"><img src="https://latex.codecogs.com/gif.latex?\large&space;\\&space;w4&space;=&space;w4&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w4)&space;\\&space;w3&space;=&space;w3&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w3)&space;\\&space;w2&space;=&space;w2&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w2&space;\\&space;w1&space;=&space;w1&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;w1)&space;\\&space;\\&space;b4&space;=&space;b4&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b4)&space;\\&space;b3&space;=&space;b3&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b3)&space;\\&space;b2&space;=&space;b2&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b2&space;\\&space;b1&space;=&space;b1&space;&plus;&space;lr&space;\times&space;(\partial&space;loss/&space;\partial&space;b1)&space;\\" title="\large \\ w4 = w4 + lr \times (\partial loss/ \partial w4) \\ w3 = w3 + lr \times (\partial loss/ \partial w3) \\ w2 = w2 + lr \times (\partial loss/ \partial w2 \\ w1 = w1 + lr \times (\partial loss/ \partial w1) \\ \\ b4 = b4 + lr \times (\partial loss/ \partial b4) \\ b3 = b3 + lr \times (\partial loss/ \partial b3) \\ b2 = b2 + lr \times (\partial loss/ \partial b2 \\ b1 = b1 + lr \times (\partial loss/ \partial b1) \\" /></a>
